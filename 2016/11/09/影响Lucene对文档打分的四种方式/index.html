
<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>影响Lucene对文档打分的四种方式 | 聘宝研发</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="影响Lucene对文档打分的四种方式">
<meta name="keywords" content="搜索引擎,apache lucene">
<meta property="og:type" content="article">
<meta property="og:title" content="影响Lucene对文档打分的四种方式">
<meta property="og:url" content="http://blog.pinbot.me/2016/11/09/影响Lucene对文档打分的四种方式/index.html">
<meta property="og:site_name" content="聘宝研发">
<meta property="og:description" content="影响Lucene对文档打分的四种方式">
<meta property="og:image" content="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478794734003.png">
<meta property="og:image" content="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478794821028.png">
<meta property="og:image" content="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478795553315.png">
<meta property="og:updated_time" content="2017-06-29T09:27:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="影响Lucene对文档打分的四种方式">
<meta name="twitter:description" content="影响Lucene对文档打分的四种方式">
<meta name="twitter:image" content="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478794734003.png">
  
    <link rel="alternative" href="/atom.xml" title="聘宝研发" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <link href="//cdn.bootcss.com/font-awesome/4.1.0/css/font-awesome.min.css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>
<body>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">聘宝研发</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一群有追求的人</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="http://www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="blog.pinbot.me">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-影响Lucene对文档打分的四种方式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/09/影响Lucene对文档打分的四种方式/" class="article-date">
  <time datetime="2016-11-09T10:00:04.000Z" itemprop="datePublished">2016-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/搜索引擎/">搜索引擎</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      影响Lucene对文档打分的四种方式
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="影响lucene对文档打分的四种方式"><a href="#影响Lucene对文档打分的四种方式" class="headerlink" title="影响Lucene对文档打分的四种方式"></a>影响Lucene对文档打分的四种方式</h1><a id="more"></a>
<h3 id="在索引阶段设置document-boost和field-boost存储在nrm文件中"><a href="#在索引阶段设置Document-Boost和Field-Boost，存储在-nrm-文件中" class="headerlink" title="在索引阶段设置Document Boost和Field Boost，存储在(.nrm)文件中"></a>在索引阶段设置Document Boost和Field Boost，存储在(.nrm)文件中</h3><p>如果希望某些文档和某些域比其他的域更重要，如果此文档和此域包含所要查询的词则应该得分较高，则可以在索引阶段设定文档的boost和域的boost值。<br>这些值是在索引阶段就写入索引文件的，存储在标准化因子(.nrm)文件中，一旦设定，除非删除此文档，否则无法改变。<br>如果不进行设定，则Document Boost和Field Boost默认为1。<br>Document Boost及FieldBoost的设定方式如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Document doc = <span class="keyword">new</span> Document();</div><div class="line">Field f = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"hello world"</span>, Field.Store.NO, Field.Index.ANALYZED);</div><div class="line">f.setBoost(<span class="number">100</span>);</div><div class="line">doc.add(f);</div><div class="line">doc.setBoost(<span class="number">100</span>);</div></pre></td></tr></table></figure></p>
<p>两者是如何影响Lucene的文档打分的呢？<br>让我们首先来看一下Lucene的文档打分的公式：<br>score(q,d)   =   coord(q,d)  ·  queryNorm(q)  ·  ∑( tf(t in d)  ·  idf(t)2  ·  t.getBoost() ·  norm(t,d) )<br>t in q</p>
<p>Document Boost和Field Boost影响的是norm(t, d)，其公式如下:<br>norm(t,d)   =   doc.getBoost()  ·  lengthNorm(field)  ·  ∏f.getBoost()<br>field f in d named as t</p>
<p>它包括三个参数：</p>
<ul>
<li>Document boost：此值越大，说明此文档越重要。</li>
<li>Field boost：此域越大，说明此域越重要。</li>
<li>lengthNorm(field) = (1.0 / Math.sqrt(numTerms))：一个域中包含的Term总数越多，也即文档越长，此值越小，文档越短，此值越大。<br>其中第三个参数可以在自己的Similarity中影响打分，下面会论述。</li>
</ul>
<p>当然，也可以在添加Field的时候，设置Field.Index.ANALYZED_NO_NORMS或Field.Index.NOT_ANALYZED_NO_NORMS，完全不用norm，来节约空间。</p>
<p>根据Lucene的注释，No norms means that index-time field and document boosting and field length normalization are disabled.  The benefit is less memory usage as norms take up one byte of RAM per indexed field for every document in the index, during searching.  Note that once you index a given field with norms enabled, disabling norms will have no effect. 没有norms意味着索引阶段禁用了文档boost和域的boost及长度标准化。好处在于节省内存，不用在搜索阶段为索引中的每篇文档的每个域都占用一个字节来保存norms信息了。但是对norms信息的禁用是必须全部域都禁用的，一旦有一个域不禁用，则其他禁用的域也会存放默认的norms值。因为为了加快norms的搜索速度，Lucene是根据文档号乘以每篇文档的norms信息所占用的大小来计算偏移量的，中间少一篇文档，偏移量将无法计算。也即norms信息要么都保存，要么都不保存。</p>
<p>下面几个试验可以验证norms信息的作用：</p>
<p>试验一：Document Boost的作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNormsDocBoost</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"testNormsDocBoost"</span>); </div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED); </div><div class="line">  writer.setUseCompoundFile(<span class="keyword">false</span>); </div><div class="line">  Document doc1 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  doc1.add(f1); </div><div class="line">  doc1.setBoost(<span class="number">100</span>); </div><div class="line">  writer.addDocument(doc1); </div><div class="line">  Document doc2 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common common hello"</span>, Field.Store.NO, Field.Index.ANALYZED_NO_NORMS); </div><div class="line">  doc2.add(f2); </div><div class="line">  writer.addDocument(doc2); </div><div class="line">  Document doc3 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f3 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common common common"</span>, Field.Store.NO, Field.Index.ANALYZED_NO_NORMS); </div><div class="line">  doc3.add(f3); </div><div class="line">  writer.addDocument(doc3); </div><div class="line">  writer.close();</div><div class="line"></div><div class="line">  IndexReader reader = IndexReader.open(FSDirectory.open(indexDir)); </div><div class="line">  IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader); </div><div class="line">  TopDocs docs = searcher.search(<span class="keyword">new</span> TermQuery(<span class="keyword">new</span> Term(<span class="string">"contents"</span>, <span class="string">"common"</span>)), <span class="number">10</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果第一篇文档的域f1也为Field.Index.ANALYZED_NO_NORMS的时候，搜索排名如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docid : 2 score : 1.2337708 </div><div class="line">docid : 1 score : 1.0073696 </div><div class="line">docid : 0 score : 0.71231794</div></pre></td></tr></table></figure></p>
<p>如果第一篇文档的域f1设为Field.Index.ANALYZED，则搜索排名如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docid : 0 score : 39.889805 </div><div class="line">docid : 2 score : 0.6168854 </div><div class="line">docid : 1 score : 0.5036848</div></pre></td></tr></table></figure></p>
<p>试验二：Field Boost的作用<br>如果我们觉得title要比contents要重要，可以做一下设定。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNormsFieldBoost</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"testNormsFieldBoost"</span>); </div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED); </div><div class="line">  writer.setUseCompoundFile(<span class="keyword">false</span>); </div><div class="line">  Document doc1 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"title"</span>, <span class="string">"common hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  f1.setBoost(<span class="number">100</span>);</div><div class="line">  doc1.add(f1); </div><div class="line">  writer.addDocument(doc1); </div><div class="line">  Document doc2 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common common hello"</span>, Field.Store.NO, Field.Index.ANALYZED_NO_NORMS); </div><div class="line">  doc2.add(f2); </div><div class="line">  writer.addDocument(doc2); </div><div class="line">  writer.close();</div><div class="line"></div><div class="line">  IndexReader reader = IndexReader.open(FSDirectory.open(indexDir)); </div><div class="line">  IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader); </div><div class="line">  QueryParser parser = <span class="keyword">new</span> QueryParser(Version.LUCENE_CURRENT, <span class="string">"contents"</span>, <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT)); </div><div class="line">  Query query = parser.parse(<span class="string">"title:common contents:common"</span>); </div><div class="line">  TopDocs docs = searcher.search(query, <span class="number">10</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果第一篇文档的域f1也为Field.Index.ANALYZED_NO_NORMS的时候，搜索排名如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 1 score : 0.49999997 </div><div class="line">docid : 0 score : 0.35355338</div></pre></td></tr></table></figure></p>
<p>如果第一篇文档的域f1设为Field.Index.ANALYZED，则搜索排名如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 0 score : 19.79899 </div><div class="line">docid : 1 score : 0.49999997</div></pre></td></tr></table></figure></p>
<p>试验三：norms中文档长度对打分的影响<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNormsLength</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"testNormsLength"</span>); </div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED); </div><div class="line">  writer.setUseCompoundFile(<span class="keyword">false</span>); </div><div class="line">  Document doc1 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED_NO_NORMS); </div><div class="line">  doc1.add(f1); </div><div class="line">  writer.addDocument(doc1); </div><div class="line">  Document doc2 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common common hello hello hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED_NO_NORMS); </div><div class="line">  doc2.add(f2); </div><div class="line">  writer.addDocument(doc2); </div><div class="line">  writer.close();</div><div class="line"></div><div class="line">  IndexReader reader = IndexReader.open(FSDirectory.open(indexDir)); </div><div class="line">  IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader); </div><div class="line">  QueryParser parser = <span class="keyword">new</span> QueryParser(Version.LUCENE_CURRENT, <span class="string">"contents"</span>, <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT)); </div><div class="line">  Query query = parser.parse(<span class="string">"title:common contents:common"</span>); </div><div class="line">  TopDocs docs = searcher.search(query, <span class="number">10</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当norms被禁用的时候，包含两个common的第二篇文档打分较高：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 1 score : 0.13928263 </div><div class="line">docid : 0 score : 0.09848769</div></pre></td></tr></table></figure></p>
<p>当norms起作用的时候，虽然包含两个common的第二篇文档，由于长度较长，因而打分较低：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 0 score : 0.09848769 </div><div class="line">docid : 1 score : 0.052230984</div></pre></td></tr></table></figure></p>
<p>试验四：norms信息要么都保存，要么都不保存的特性<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOmitNorms</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"testOmitNorms"</span>); </div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED); </div><div class="line">  writer.setUseCompoundFile(<span class="keyword">false</span>); </div><div class="line">  Document doc1 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"title"</span>, <span class="string">"common hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  doc1.add(f1); </div><div class="line">  writer.addDocument(doc1); </div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123; </div><div class="line">    Document doc2 = <span class="keyword">new</span> Document(); </div><div class="line">    Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common common hello hello hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED_NO_NORMS); </div><div class="line">    doc2.add(f2); </div><div class="line">    writer.addDocument(doc2); </div><div class="line">  &#125; </div><div class="line">  writer.close(); </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当我们添加10001篇文档，所有的文档都设为Field.Index.ANALYZED_NO_NORMS的时候，我们看索引文件，发现.nrm文件只有1K，也即其中除了保持一定的格式信息，并无其他数据。<br><img src="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478794734003.png" alt="2016-11-11-截图" title="blob_1478794734003.png"><br>当我们把第一篇文档设为Field.Index.ANALYZED，而其他10000篇文档都设为Field.Index.ANALYZED_NO_NORMS的时候，发现.nrm文件又10K，也即所有的文档都存储了norms信息，而非只有第一篇文档。<br><img src="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478794821028.png" alt="2016-11-11-截图" title="blob_1478794821028.png"></p>
<h3 id="在搜索语句中设置query-boost"><a href="#在搜索语句中，设置Query-Boost" class="headerlink" title="在搜索语句中，设置Query Boost."></a>在搜索语句中，设置Query Boost.</h3><p>在搜索中，我们可以指定，某些词对我们来说更重要，我们可以设置这个词的boost：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">common^4 hello</div></pre></td></tr></table></figure></p>
<p>使得包含common的文档比包含hello的文档获得更高的分数。<br>由于在Lucene中，一个Term定义为Field:Term，则也可以影响不同域的打分：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">title:common^4 content:common</div></pre></td></tr></table></figure></p>
<p>使得title中包含common的文档比content中包含common的文档获得更高的分数。<br>实例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQueryBoost</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"TestQueryBoost"</span>); </div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED); </div><div class="line">  Document doc1 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common1 hello hello"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  doc1.add(f1); </div><div class="line">  writer.addDocument(doc1); </div><div class="line">  Document doc2 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common2 common2 hello"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  doc2.add(f2); </div><div class="line">  writer.addDocument(doc2); </div><div class="line">  writer.close();</div><div class="line"></div><div class="line">  IndexReader reader = IndexReader.open(FSDirectory.open(indexDir)); </div><div class="line">  IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader); </div><div class="line">  QueryParser parser = <span class="keyword">new</span> QueryParser(Version.LUCENE_CURRENT, <span class="string">"contents"</span>, <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT)); </div><div class="line">  Query query = parser.parse(<span class="string">"common1 common2"</span>); </div><div class="line">  TopDocs docs = searcher.search(query, <span class="number">10</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>根据tf/idf，包含两个common2的第二篇文档打分较高：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 1 score : 0.24999999 </div><div class="line">docid : 0 score : 0.17677669</div></pre></td></tr></table></figure></p>
<p>如果我们输入的查询语句为：”common1^100 common2”，则第一篇文档打分较高：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 0 score : 0.2499875 </div><div class="line">docid : 1 score : 0.0035353568</div></pre></td></tr></table></figure></p>
<p>那Query Boost是如何影响文档打分的呢？<br>根据Lucene的打分计算公式：<br>score(q,d)   =   coord(q,d)  ·  queryNorm(q)  · ∑( tf(t in d)  ·  idf(t)2  ·  t.getBoost() ·  norm(t,d) )<br>t in q<br>注：在queryNorm的部分，也有q.getBoost()的部分，但是对query向量的归一化(见向量空间模型与Lucene的打分机制[<a href="http://forfuture1978.javaeye.com/blog/588721])。" target="_blank" rel="external">http://forfuture1978.javaeye.com/blog/588721])。</a></p>
<h3 id="继承并实现自己的similarity"><a href="#继承并实现自己的Similarity" class="headerlink" title="继承并实现自己的Similarity"></a>继承并实现自己的Similarity</h3><p>Similariy是计算Lucene打分的最主要的类，实现其中的很多借口可以干预打分的过程。<br>(1) float computeNorm(String field, FieldInvertState state)<br>(2) float lengthNorm(String fieldName, int numTokens)<br>(3) float queryNorm(float sumOfSquaredWeights)<br>(4) float tf(float freq)<br>(5) float idf(int docFreq, int numDocs)<br>(6) float coord(int overlap, int maxOverlap)<br>(7) float scorePayload(int docId, String fieldName, int start, int end, byte [] payload, int offset, int length)</p>
<p>它们分别影响Lucene打分计算的如下部分：<br>score(q,d)   =   (6)coord(q,d)  ·  (3)queryNorm(q)  · ∑( (4)tf(t in d)  ·  (5)idf(t)2  ·  t.getBoost() ·  (1)norm(t,d) )<br>t in q<br>norm(t,d)   =   doc.getBoost()  ·  (2)lengthNorm(field)  ·  ∏f.getBoost()<br>field f in d named as t</p>
<p>下面逐个进行解释：<br>(1) float computeNorm(String field, FieldInvertState state)<br>影响标准化因子的计算，如上述，他主要包含了三部分：文档boost，域boost，以及文档长度归一化。此函数一般按照上面norm(t, d)的公式进行计算。<br>(2) float lengthNorm(String fieldName, int numTokens)<br>主要计算文档长度的归一化，默认是1.0 / Math.sqrt(numTerms)。<br>因为在索引中，不同的文档长度不一样，很显然，对于任意一个term，在长的文档中的tf要大的多，因而分数也越高，这样对小的文档不公平，举一个极端的例子，在一篇1000万个词的鸿篇巨著中，”lucene”这个词出现了11次，而在一篇12个词的短小文档中，”lucene”这个词出现了10次，如果不考虑长度在内，当然鸿篇巨著应该分数更高，然而显然这篇小文档才是真正关注”lucene”的。<br>因而在此处是要除以文档的长度，从而减少因文档长度带来的打分不公。<br>然而现在这个公式是偏向于首先返回短小的文档的，这样在实际应用中使得搜索结果也很难看。<br>于是在实践中，要根据项目的需要，根据搜索的领域，改写lengthNorm的计算公式。比如我想做一个经济学论文的搜索系统，经过一定时间的调研，发现大多数的经济学论文的长度在8000到10000词，因而lengthNorm的公式应该是一个倒抛物线型的，8000到10000词的论文分数最高，更短或更长的分数都应该偏低，方能够返回给用户最好的数据。<br>(3) float queryNorm(float sumOfSquaredWeights)<br>这是按照向量空间模型，对query向量的归一化。此值并不影响排序，而仅仅使得不同的query之间的分数可以比较。<br>(4) float tf(float freq)<br>freq是指在一篇文档中包含的某个词的数目。tf是根据此数目给出的分数，默认为Math.sqrt(freq)。也即此项并不是随着包含的数目的增多而线性增加的。<br>(5) float idf(int docFreq, int numDocs)<br>idf是根据包含某个词的文档数以及总文档数计算出的分数，默认为(Math.log(numDocs/(double)(docFreq+1)) + 1.0)。<br>由于此项计算涉及到总文档数和包含此词的文档数，因而需要全局的文档数信息，这给跨索引搜索造成麻烦。<br>从下面的例子我们可以看出，用MultiSearcher来一起搜索两个索引和分别用IndexSearcher来搜索两个索引所得出的分数是有很大差异的。<br>究其原因是MultiSearcher的docFreq(Term term)函数计算了包含两个索引中包含此词的总文档数，而IndexSearcher仅仅计算了每个索引中包含此词的文档数。当两个索引包含的文档总数是有很大不同的时候，分数是无法比较的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMultiIndex</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; </div><div class="line">  MultiIndexSimilarity sim = <span class="keyword">new</span> MultiIndexSimilarity(); </div><div class="line">  File indexDir01 = <span class="keyword">new</span> File(<span class="string">"TestMultiIndex/TestMultiIndex01"</span>); </div><div class="line">  File indexDir02 = <span class="keyword">new</span> File(<span class="string">"TestMultiIndex/TestMultiIndex02"</span>); </div><div class="line">  IndexReader reader01 = IndexReader.open(FSDirectory.open(indexDir01)); </div><div class="line">  IndexReader reader02 = IndexReader.open(FSDirectory.open(indexDir02)); </div><div class="line">  IndexSearcher searcher01 = <span class="keyword">new</span> IndexSearcher(reader01); </div><div class="line">  searcher01.setSimilarity(sim); </div><div class="line">  IndexSearcher searcher02 = <span class="keyword">new</span> IndexSearcher(reader02); </div><div class="line">  searcher02.setSimilarity(sim); </div><div class="line">  MultiSearcher multiseacher = <span class="keyword">new</span> MultiSearcher(searcher01, searcher02); </div><div class="line">  multiseacher.setSimilarity(sim); </div><div class="line">  QueryParser parser = <span class="keyword">new</span> QueryParser(Version.LUCENE_CURRENT, <span class="string">"contents"</span>, <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT)); </div><div class="line">  Query query = parser.parse(<span class="string">"common"</span>); </div><div class="line">  TopDocs docs = searcher01.search(query, <span class="number">10</span>); </div><div class="line">  System.out.println(<span class="string">"----------------------------------------------"</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">  System.out.println(<span class="string">"----------------------------------------------"</span>); </div><div class="line">  docs = searcher02.search(query, <span class="number">10</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">  System.out.println(<span class="string">"----------------------------------------------"</span>); </div><div class="line">  docs = multiseacher.search(query, <span class="number">20</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">结果为：</div><div class="line"></div><div class="line">------------------------------- </div><div class="line">docid : 0 score : 0.49317428 </div><div class="line">docid : 1 score : 0.49317428 </div><div class="line">docid : 2 score : 0.49317428 </div><div class="line">docid : 3 score : 0.49317428 </div><div class="line">docid : 4 score : 0.49317428 </div><div class="line">docid : 5 score : 0.49317428 </div><div class="line">docid : 6 score : 0.49317428 </div><div class="line">docid : 7 score : 0.49317428 </div><div class="line">------------------------------- </div><div class="line">docid : 0 score : 0.45709616 </div><div class="line">docid : 1 score : 0.45709616 </div><div class="line">docid : 2 score : 0.45709616 </div><div class="line">docid : 3 score : 0.45709616 </div><div class="line">docid : 4 score : 0.45709616 </div><div class="line">------------------------------- </div><div class="line">docid : 0 score : 0.5175894 </div><div class="line">docid : 1 score : 0.5175894 </div><div class="line">docid : 2 score : 0.5175894 </div><div class="line">docid : 3 score : 0.5175894 </div><div class="line">docid : 4 score : 0.5175894 </div><div class="line">docid : 5 score : 0.5175894 </div><div class="line">docid : 6 score : 0.5175894 </div><div class="line">docid : 7 score : 0.5175894 </div><div class="line">docid : 8 score : 0.5175894 </div><div class="line">docid : 9 score : 0.5175894 </div><div class="line">docid : 10 score : 0.5175894 </div><div class="line">docid : 11 score : 0.5175894 </div><div class="line">docid : 12 score : 0.5175894</div></pre></td></tr></table></figure>
<p>(6) float coord(int overlap, int maxOverlap)<br>一次搜索可能包含多个搜索词，而一篇文档中也可能包含多个搜索词，此项表示，当一篇文档中包含的搜索词越多，则此文档则打分越高。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestCoord</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </div><div class="line">  MySimilarity sim = <span class="keyword">new</span> MySimilarity(); </div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"TestCoord"</span>); </div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED); </div><div class="line">  Document doc1 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common hello world"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  doc1.add(f1); </div><div class="line">  writer.addDocument(doc1); </div><div class="line">  Document doc2 = <span class="keyword">new</span> Document(); </div><div class="line">  Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common common common"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">  doc2.add(f2); </div><div class="line">  writer.addDocument(doc2); </div><div class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123; </div><div class="line">    Document doc3 = <span class="keyword">new</span> Document(); </div><div class="line">    Field f3 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"world"</span>, Field.Store.NO, Field.Index.ANALYZED); </div><div class="line">    doc3.add(f3); </div><div class="line">    writer.addDocument(doc3); </div><div class="line">  &#125; </div><div class="line">  writer.close();</div><div class="line"></div><div class="line">  IndexReader reader = IndexReader.open(FSDirectory.open(indexDir)); </div><div class="line">  IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader); </div><div class="line">  searcher.setSimilarity(sim); </div><div class="line">  QueryParser parser = <span class="keyword">new</span> QueryParser(Version.LUCENE_CURRENT, <span class="string">"contents"</span>, <span class="keyword">new</span> StandardAnalyzer(Version.LUCENE_CURRENT)); </div><div class="line">  Query query = parser.parse(<span class="string">"common world"</span>); </div><div class="line">  TopDocs docs = searcher.search(query, <span class="number">2</span>); </div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123; </div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score); </div><div class="line">  &#125; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySimilarity</span> <span class="keyword">extends</span> <span class="title">Similarity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">coord</span><span class="params">(<span class="keyword">int</span> overlap, <span class="keyword">int</span> maxOverlap)</span> </span>&#123; </div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>; </div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上面的实例，当coord返回1，不起作用的时候，文档一虽然包含了两个搜索词common和world，但由于world的所在的文档数太多，而文档二包含common的次数比较多，因而文档二分数较高：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 1 score : 1.9059997 </div><div class="line">docid : 0 score : 1.2936771</div></pre></td></tr></table></figure></p>
<p>而当coord起作用的时候，文档一由于包含了两个搜索词而分数较高：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySimilarity</span> <span class="keyword">extends</span> <span class="title">Similarity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span> </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">coord</span><span class="params">(<span class="keyword">int</span> overlap, <span class="keyword">int</span> maxOverlap)</span> </span>&#123; </div><div class="line">    <span class="keyword">return</span> overlap / (<span class="keyword">float</span>)maxOverlap; </div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">docid : 0 score : 1.2936771 </div><div class="line">docid : 1 score : 0.95299983</div></pre></td></tr></table></figure>
<p>(7) float scorePayload(int docId, String fieldName, int start, int end, byte [] payload, int offset, int length)<br>由于Lucene引入了payload，因而可以存储一些自己的信息，用户可以根据自己存储的信息，来影响Lucene的打分。<br>payload的定义<br>我们知道，索引是以倒排表形式存储的，对于每一个词，都保存了包含这个词的一个链表，当然为了加快查询速度，此链表多用跳跃表进行存储。<br>Payload信息就是存储在倒排表中的，同文档号一起存放，多用于存储与每篇文档相关的一些信息。当然这部分信息也可以存储域里(stored Field)，两者从功能上基本是一样的，然而当要存储的信息很多的时候，存放在倒排表里，利用跳跃表，有利于大大提高搜索速度。<br>Payload的存储方式如下图：<br><img src="http://img.pinbot.me:8080/uploads/2016/11/11/blob_1478795553315.png" alt="2016-11-11-截图" title="blob_1478795553315.png"><br>由payload的定义，我们可以看出，payload可以存储一些不但与文档相关，而且与查询词也相关的信息。比如某篇文档的某个词有特殊性，则可以在这个词的这个文档的position信息后存储payload信息，使得当搜索这个词的时候，这篇文档获得较高的分数。<br>要利用payload来影响查询需要做到以下几点，下面举例用<b></b>标记的词在payload中存储1，否则存储0：<br>首先要实现自己的Analyzer从而在Token中放入payload信息：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoldAnalyzer</span> <span class="keyword">extends</span> <span class="title">Analyzer</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> TokenStream <span class="title">tokenStream</span><span class="params">(String fieldName, Reader reader)</span> </span>&#123;</div><div class="line">    TokenStream result = <span class="keyword">new</span> WhitespaceTokenizer(reader);</div><div class="line">    result = <span class="keyword">new</span> BoldFilter(result);</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoldFilter</span> <span class="keyword">extends</span> <span class="title">TokenFilter</span> </span>&#123;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> IS_NOT_BOLD = <span class="number">0</span>;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> IS_BOLD = <span class="number">1</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> TermAttribute termAtt;</div><div class="line">  <span class="keyword">private</span> PayloadAttribute payloadAtt;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="title">BoldFilter</span><span class="params">(TokenStream input)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(input);</div><div class="line">    termAtt = addAttribute(TermAttribute.class);</div><div class="line">    payloadAtt = addAttribute(PayloadAttribute.class);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">incrementToken</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (input.incrementToken()) &#123;</div><div class="line"></div><div class="line">      <span class="keyword">final</span> <span class="keyword">char</span>[] buffer = termAtt.termBuffer();</div><div class="line">      <span class="keyword">final</span> <span class="keyword">int</span> length = termAtt.termLength();</div><div class="line"></div><div class="line">      String tokenstring = <span class="keyword">new</span> String(buffer, <span class="number">0</span>, length);</div><div class="line">      <span class="keyword">if</span> (tokenstring.startsWith(<span class="string">"&lt;b&gt;"</span>) &amp;&amp; tokenstring.endsWith(<span class="string">"&lt;/b&gt;"</span>)) &#123;</div><div class="line">        tokenstring = tokenstring.replace(<span class="string">"&lt;b&gt;"</span>, <span class="string">""</span>);</div><div class="line">        tokenstring = tokenstring.replace(<span class="string">"&lt;/b&gt;"</span>, <span class="string">""</span>);</div><div class="line">        termAtt.setTermBuffer(tokenstring);</div><div class="line">        payloadAtt.setPayload(<span class="keyword">new</span> Payload(int2bytes(IS_BOLD)));</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        payloadAtt.setPayload(<span class="keyword">new</span> Payload(int2bytes(IS_NOT_BOLD)));</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">bytes2int</span><span class="params">(<span class="keyword">byte</span>[] b)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> mask = <span class="number">0xff</span>;</div><div class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">      res &lt;&lt;= <span class="number">8</span>;</div><div class="line">      temp = b[i] &amp; mask;</div><div class="line">      res |= temp;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] int2bytes(<span class="keyword">int</span> num) &#123;</div><div class="line">    <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">      b[i] = (<span class="keyword">byte</span>) (num &gt;&gt;&gt; (<span class="number">24</span> - i * <span class="number">8</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> b;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后，实现自己的Similarity，从payload中读出信息，根据信息来打分。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayloadSimilarity</span> <span class="keyword">extends</span> <span class="title">DefaultSimilarity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">scorePayload</span><span class="params">(<span class="keyword">int</span> docId, String fieldName, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">byte</span>[] payload, <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> isbold = BoldFilter.bytes2int(payload);</div><div class="line">    <span class="keyword">if</span>(isbold == BoldFilter.IS_BOLD)&#123;</div><div class="line">      System.out.println(<span class="string">"It is a bold char."</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      System.out.println(<span class="string">"It is not a bold char."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后，查询的时候，一定要用PayloadXXXQuery(在此用PayloadTermQuery，在Lucene 2.4.1中，用BoostingTermQuery)，否则scorePayload不起作用。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPayloadScore</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">  PayloadSimilarity sim = <span class="keyword">new</span> PayloadSimilarity();</div><div class="line">  File indexDir = <span class="keyword">new</span> File(<span class="string">"TestPayloadScore"</span>);</div><div class="line">  IndexWriter writer = <span class="keyword">new</span> IndexWriter(FSDirectory.open(indexDir), <span class="keyword">new</span> BoldAnalyzer(), <span class="keyword">true</span>, IndexWriter.MaxFieldLength.LIMITED);</div><div class="line">  Document doc1 = <span class="keyword">new</span> Document();</div><div class="line">  Field f1 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common hello world"</span>, Field.Store.NO, Field.Index.ANALYZED);</div><div class="line">  doc1.add(f1);</div><div class="line">  writer.addDocument(doc1);</div><div class="line">  Document doc2 = <span class="keyword">new</span> Document();</div><div class="line">  Field f2 = <span class="keyword">new</span> Field(<span class="string">"contents"</span>, <span class="string">"common &lt;b&gt;hello&lt;/b&gt; world"</span>, Field.Store.NO, Field.Index.ANALYZED);</div><div class="line">  doc2.add(f2);</div><div class="line">  writer.addDocument(doc2);</div><div class="line">  writer.close();</div><div class="line"></div><div class="line">  IndexReader reader = IndexReader.open(FSDirectory.open(indexDir));</div><div class="line">  IndexSearcher searcher = <span class="keyword">new</span> IndexSearcher(reader);</div><div class="line">  searcher.setSimilarity(sim);</div><div class="line">  PayloadTermQuery query = <span class="keyword">new</span> PayloadTermQuery(<span class="keyword">new</span> Term(<span class="string">"contents"</span>, <span class="string">"hello"</span>), <span class="keyword">new</span> MaxPayloadFunction());</div><div class="line">  TopDocs docs = searcher.search(query, <span class="number">10</span>);</div><div class="line">  <span class="keyword">for</span> (ScoreDoc doc : docs.scoreDocs) &#123;</div><div class="line">    System.out.println(<span class="string">"docid : "</span> + doc.doc + <span class="string">" score : "</span> + doc.score);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果scorePayload函数始终是返回1，则结果如下，<b></b>不起作用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">It is not a bold char.</div><div class="line">It is a bold char.</div><div class="line">docid : 0 score : 0.2101998</div><div class="line">docid : 1 score : 0.2101998</div></pre></td></tr></table></figure></p>
<p>如果scorePayload函数如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayloadSimilarity</span> <span class="keyword">extends</span> <span class="title">DefaultSimilarity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">scorePayload</span><span class="params">(<span class="keyword">int</span> docId, String fieldName, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">byte</span>[] payload, <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> isbold = BoldFilter.bytes2int(payload);</div><div class="line">    <span class="keyword">if</span>(isbold == BoldFilter.IS_BOLD)&#123;</div><div class="line">      System.out.println(<span class="string">"It is a bold char."</span>);</div><div class="line">      <span class="keyword">return</span> <span class="number">10</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      System.out.println(<span class="string">"It is not a bold char."</span>);</div><div class="line">      <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>则结果如下，同样是包含hello，包含加粗的文档获得较高分：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">It is not a bold char.</div><div class="line">It is a bold char.</div><div class="line">docid : 1 score : 2.101998</div><div class="line">docid : 0 score : 0.2101998</div></pre></td></tr></table></figure></p>
<h3 id="继承并实现自己的collector"><a href="#继承并实现自己的collector" class="headerlink" title="继承并实现自己的collector"></a>继承并实现自己的collector</h3><p>以上各种方法，已经把Lucene score计算公式的所有变量都涉及了，如果这还不能满足您的要求，还可以继承实现自己的collector。<br>在Lucene 2.4中，HitCollector有个函数public abstract void collect(int doc, float score)，用来收集搜索的结果。<br>其中TopDocCollector的实现如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">collect</span><span class="params">(<span class="keyword">int</span> doc, <span class="keyword">float</span> score)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (score &gt; <span class="number">0.0f</span>) &#123;</div><div class="line">    totalHits++;</div><div class="line">    <span class="keyword">if</span> (reusableSD == <span class="keyword">null</span>) &#123;</div><div class="line">      reusableSD = <span class="keyword">new</span> ScoreDoc(doc, score);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (score &gt;= reusableSD.score) &#123;</div><div class="line">      reusableSD.doc = doc;</div><div class="line">      reusableSD.score = score;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    reusableSD = (ScoreDoc) hq.insertWithOverflow(reusableSD);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此函数将docid和score插入一个PriorityQueue中，使得得分最高的文档先返回。<br>我们可以继承HitCollector，并在此函数中对score进行修改，然后再插入PriorityQueue，或者插入自己的数据结构。<br>比如我们在另外的地方存储docid和文档创建时间的对应，我们希望当文档时间是一天之内的分数最高，一周之内的分数其次，一个月之外的分数很低。<br>我们可以这样修改：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> milisecondsOneDay = <span class="number">24L</span> * <span class="number">3600L</span> * <span class="number">1000L</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> millisecondsOneWeek = <span class="number">7L</span> * <span class="number">24L</span> * <span class="number">3600L</span> * <span class="number">1000L</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> millisecondsOneMonth = <span class="number">30L</span> * <span class="number">24L</span> * <span class="number">3600L</span> * <span class="number">1000L</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">collect</span><span class="params">(<span class="keyword">int</span> doc, <span class="keyword">float</span> score)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (score &gt; <span class="number">0.0f</span>) &#123;</div><div class="line"></div><div class="line">    <span class="keyword">long</span> time = getTimeByDocId(doc);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(time &lt; milisecondsOneDay) &#123;</div><div class="line"></div><div class="line">        score = score * <span class="number">1.0</span>;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (time &lt; millisecondsOneWeek)&#123;</div><div class="line"></div><div class="line">        score = score * <span class="number">0.8</span>;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (time &lt; millisecondsOneMonth) &#123;</div><div class="line"></div><div class="line">        score = score * <span class="number">0.3</span>;</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">        score = score * <span class="number">0.1</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    totalHits++;</div><div class="line">    <span class="keyword">if</span> (reusableSD == <span class="keyword">null</span>) &#123;</div><div class="line">      reusableSD = <span class="keyword">new</span> ScoreDoc(doc, score);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (score &gt;= reusableSD.score) &#123;</div><div class="line">      reusableSD.doc = doc;</div><div class="line">      reusableSD.score = score;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    reusableSD = (ScoreDoc) hq.insertWithOverflow(reusableSD);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在Lucene 3.0中，Collector接口为void collect(int doc)，TopScoreDocCollector实现如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">collect</span><span class="params">(<span class="keyword">int</span> doc)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">  <span class="keyword">float</span> score = scorer.score();</div><div class="line">  totalHits++;</div><div class="line">  <span class="keyword">if</span> (score &lt;= pqTop.score) &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">  &#125;</div><div class="line">  pqTop.doc = doc + docBase;</div><div class="line">  pqTop.score = score;</div><div class="line">  pqTop = pq.updateTop();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样可以用上面的方式影响其打分。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://blog.pinbot.me/2016/11/09/影响Lucene对文档打分的四种方式/" data-id="cj4jfz5nc0022dywbq8ivt17d" class="article-share-link" data-share="baidu" data-title="影响Lucene对文档打分的四种方式">分享到</a>
      

      
        <a href="http://blog.pinbot.me/2016/11/09/影响Lucene对文档打分的四种方式/#wy_thread" class="article-comment-link">评论</a>
      

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apache-lucene/">apache lucene</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/搜索引擎/">搜索引擎</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/11/09/web存储方式/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          web客户端存储方式
        
      </div>
    </a>
  
  
    <a href="/2016/11/09/mysql性能优化/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">MySQL性能优化</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="wy_thread">
      <noscript>Please enable JavaScript</noscript>
      <!-- UY BEGIN -->
      <div id="uyan_frame"></div>
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2137766"></script>
      <!-- UY END -->
    </div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/UML/">UML</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">blog</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/django/">django</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/react/">react</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/招聘/">招聘</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/搜索引擎/">搜索引擎</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/">Django</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/">ES6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kxrr/">Kxrr</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nodejs/">Nodejs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NotImplemented/">NotImplemented</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORM/">ORM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js/">Vue.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apache-lucene/">apache lucene</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ascii/">ascii</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/">django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pypi/">pypi</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pyspark/">pyspark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/setup-py/">setup.py</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spark/">spark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sphinx/">sphinx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/str/">str</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unicode-literals/">unicode_literals</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/其他/">其他</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/开始/">开始</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术/">技术</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/招聘/">招聘</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/搜索引擎/">搜索引擎</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/经验总结/">经验总结</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/运维/">运维</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面向对象/">面向对象</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Django/" style="font-size: 12.5px;">Django</a> <a href="/tags/ES6/" style="font-size: 10px;">ES6</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/Kxrr/" style="font-size: 10px;">Kxrr</a> <a href="/tags/Nodejs/" style="font-size: 10px;">Nodejs</a> <a href="/tags/NotImplemented/" style="font-size: 10px;">NotImplemented</a> <a href="/tags/ORM/" style="font-size: 10px;">ORM</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Vue-js/" style="font-size: 10px;">Vue.js</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/apache-lucene/" style="font-size: 15px;">apache lucene</a> <a href="/tags/ascii/" style="font-size: 10px;">ascii</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/image/" style="font-size: 10px;">image</a> <a href="/tags/javascript/" style="font-size: 12.5px;">javascript</a> <a href="/tags/pypi/" style="font-size: 10px;">pypi</a> <a href="/tags/pyspark/" style="font-size: 10px;">pyspark</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/setup-py/" style="font-size: 10px;">setup.py</a> <a href="/tags/spark/" style="font-size: 10px;">spark</a> <a href="/tags/sphinx/" style="font-size: 10px;">sphinx</a> <a href="/tags/str/" style="font-size: 10px;">str</a> <a href="/tags/unicode-literals/" style="font-size: 10px;">unicode_literals</a> <a href="/tags/其他/" style="font-size: 10px;">其他</a> <a href="/tags/并发/" style="font-size: 10px;">并发</a> <a href="/tags/开始/" style="font-size: 10px;">开始</a> <a href="/tags/技术/" style="font-size: 10px;">技术</a> <a href="/tags/招聘/" style="font-size: 10px;">招聘</a> <a href="/tags/搜索引擎/" style="font-size: 15px;">搜索引擎</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/经验总结/" style="font-size: 10px;">经验总结</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/运维/" style="font-size: 17.5px;">运维</a> <a href="/tags/面向对象/" style="font-size: 10px;">面向对象</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/06/25/用Sphinx快速制作文档/">用Sphinx快速制作文档</a>
          </li>
        
          <li>
            <a href="/2016/11/29/Python打包发布一条龙/">Python打包发布一条龙</a>
          </li>
        
          <li>
            <a href="/2016/11/18/Django入门进阶/">Django入门进阶</a>
          </li>
        
          <li>
            <a href="/2016/11/09/使用R并行方式对数值型数据离散化/">使用R并行方式对数值型数据离散化</a>
          </li>
        
          <li>
            <a href="/2016/11/09/向量的相似性度量/">向量的相似性度量</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="" target="_blank">聘宝产品</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 聘宝研发<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->



<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>



<script src="/js/script.js"></script>

</div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
